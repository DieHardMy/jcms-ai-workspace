const COIN_STYLES={heads:'heads',tails:'tails',flipping:'flipping',neutral:'neutral'};document.addEventListener('DOMContentLoaded',()=>{const SERVER_TIMEOUT=20000;let localTossCount=0;const coin=document.getElementById('coin');const tossCoinButton=document.getElementById('tossCoin');const resultDiv=document.getElementById('result');const totalCoinTossesSpan=document.getElementById('total_coin_tosses');let isProcessing=false;let tossResult=null;const csrfTokenMeta=document.querySelector('meta[name="csrf-token"]');const csrfToken=csrfTokenMeta===null||csrfTokenMeta===void 0?void 0:csrfTokenMeta.getAttribute('content');if(totalCoinTossesSpan){localTossCount=parseInt(totalCoinTossesSpan.textContent||'0',10)}coin===null||coin===void 0?void 0:coin.addEventListener('animationend',()=>{if(tossResult){handleResult(tossResult)}tossResult=null;isProcessing=false;tossCoinButton===null||tossCoinButton===void 0?void 0:tossCoinButton.removeAttribute('disabled')});function tossCoin(){if(isProcessing)return;isProcessing=true;tossCoinButton===null||tossCoinButton===void 0?void 0:tossCoinButton.setAttribute('disabled','true');resetCoinStyles();localTossCount++;if(coin){coin.classList.add(COIN_STYLES.flipping)}const controller=new AbortController();const timeoutId=setTimeout(()=>{controller.abort()},SERVER_TIMEOUT);fetch('api/',{method:'POST',headers:{'X-CSRF-TOKEN':csrfToken||'','Content-Type':'application/json'},signal:controller.signal}).then(response=>{if(!response.ok)throw new Error(response.status.toString());return response.json()}).then((data)=>{if(data.total_coin_tosses&&data.total_coin_tosses>localTossCount){localTossCount=data.total_coin_tosses}tossResult={side:data.side===0?COIN_STYLES.heads:COIN_STYLES.tails,message:data.message||'',total_coin_tosses:localTossCount}}).catch(error=>{console.error('[CoinFlip] Fetch error:',error);let side=Math.random()<0.5?COIN_STYLES.heads:COIN_STYLES.tails;tossResult={side:side,message:side===COIN_STYLES.heads?'Your result is — heads':'Your result is — tails',total_coin_tosses:localTossCount}}).finally(()=>{clearTimeout(timeoutId)})}function handleResult(a){var b;if(!coin||!resultDiv)return;coin.classList.remove(COIN_STYLES.heads,COIN_STYLES.tails,COIN_STYLES.flipping,COIN_STYLES.neutral);coin.classList.add(a.side===COIN_STYLES.heads?COIN_STYLES.heads:COIN_STYLES.tails);resultDiv.textContent=(b=a.message)!==null&&b!==void 0?b:'';resultDiv.classList.toggle('hidden',!a.message);if(a.total_coin_tosses&&totalCoinTossesSpan){totalCoinTossesSpan.textContent=a.total_coin_tosses.toString()}}function resetCoinStyles(){if(!coin||!resultDiv)return;resultDiv.textContent='???';coin.classList.remove(COIN_STYLES.heads,COIN_STYLES.tails,COIN_STYLES.flipping,COIN_STYLES.neutral);coin.classList.add(COIN_STYLES.neutral)}coin===null||coin===void 0?void 0:coin.addEventListener('click',tossCoin);tossCoinButton===null||tossCoinButton===void 0?void 0:tossCoinButton.addEventListener('click',tossCoin)});
